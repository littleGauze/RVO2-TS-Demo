# RVO2 小球避障演示

这是一个使用RVO2（Reciprocal Velocity Obstacles 2）算法实现的小球避障演示程序，展示了多智能体系统中的碰撞避免和路径规划。

## 功能特性

- **多智能体仿真**: 支持多个智能体同时运动
- **智能避障**: 使用RVO2算法实现智能碰撞避免
- **实时交互**: 支持鼠标点击添加/删除智能体
- **参数调节**: 可调节智能体数量、障碍物数量和仿真速度
- **可视化**: 使用HTML5 Canvas进行实时渲染
- **性能监控**: 显示FPS和仿真时间

## 使用方法

### 1. 启动演示

直接在浏览器中打开 `demo.html` 文件即可启动演示。

### 2. 基本操作

- **鼠标点击**: 在画布上点击添加新的智能体
- **Ctrl+点击**: 删除最近的智能体
- **空格键**: 暂停/继续仿真
- **R键**: 重置仿真

### 3. 参数调节

- **智能体数量**: 调节滑块改变智能体数量（1-50）
- **障碍物数量**: 调节滑块改变内部障碍物数量（0-10）
- **仿真速度**: 调节滑块改变仿真速度（1-10）

### 4. 界面说明

- **绿色小球**: 智能体，颜色根据速度变化（绿色=慢速，红色=快速）
- **橙色圆点**: 目标点，智能体会自动寻找并移动到目标
- **灰色边框**: 边界障碍物
- **灰色圆形**: 内部障碍物
- **网格**: 50x50像素的参考网格

## 技术实现

### 核心算法

- **RVO2算法**: 基于互惠速度障碍物的碰撞避免算法
- **ORCA线**: 最优互惠碰撞避免约束线
- **线性规划**: 求解最优速度向量

### 架构设计

- **TypeScript**: 提供类型安全和现代JavaScript特性
- **模块化**: 清晰的类层次结构，易于扩展
- **单例模式**: Simulator使用单例模式管理仿真状态
- **事件驱动**: 基于事件的用户交互处理

### 性能优化

- **KD树**: 用于快速邻居搜索
- **空间分区**: 智能体邻居检测优化
- **帧率控制**: 使用requestAnimationFrame进行渲染

## 文件结构

```
RVO2/
├── demo.html          # 演示页面
├── demo.ts            # 演示程序TypeScript源码
├── demo.js            # 编译后的JavaScript代码
├── index.ts           # 库入口文件
├── Simulator.ts       # 仿真器核心类
├── Agent.ts           # 智能体类
├── Vector2.ts         # 二维向量类
├── RVOMath.ts         # 数学工具类
├── KdTree.ts          # KD树实现
├── Obstacle.ts        # 障碍物类
├── Line.ts            # 几何线类
└── test_rvo2.ts       # 库功能测试脚本
```

## 开发说明

### 编译

```bash
# 安装依赖
npm install

# 编译TypeScript
npx tsc

# 运行测试
npx ts-node test_rvo2.ts
```

### 扩展功能

- **新的智能体类型**: 继承Agent类并重写相关方法
- **自定义障碍物**: 实现复杂的几何形状
- **路径规划**: 集成A*等路径规划算法
- **物理引擎**: 添加重力、摩擦力等物理效果

## 故障排除

### 常见问题

1. **智能体不移动**: 检查目标点设置和首选速度
2. **性能问题**: 减少智能体数量或降低仿真速度
3. **编译错误**: 确保TypeScript版本兼容性

### 调试技巧

- 打开浏览器控制台查看错误信息
- 使用`test_rvo2.ts`验证库功能
- 检查Canvas元素是否正确加载

## 许可证

本项目基于Apache 2.0许可证开源。

## 致谢

- 原始RVO2算法由北卡罗来纳大学教堂山分校开发
- TypeScript翻译和演示程序由社区贡献

---

**享受RVO2算法的魅力！** 🚀
